import React, { useState, useEffect } from 'react';

// Define a type for the operation parameter
type OperationType = 'add' | 'subtract';

function NumberOperations() {
  // State to store the current sum
  const [sum, setSum] = useState<number>(0);
  
  // State to store the current step/iteration number
  const [step, setStep] = useState<number>(0);
  
  // State to store all calculation history as an array of strings
  const [history, setHistory] = useState<string[]>([]);

  // This useEffect runs automatically when component mounts
  // The empty array [] as second parameter means it runs only once
  useEffect(() => {
    console.log("Component mounted - starting calculations");
    
    // Start the calculation process automatically
    startCalculations();
  }, []);

  // Function to manually start calculations with a button
  const startCalculations = (): void => {
    console.log("Starting calculations...");
    
    // Reset all states to initial values
    setSum(0);
    setStep(0);
    setHistory([]);
    
    // Start with step 1 (adding 1)
    executeStep(1, 'add');
  };

  // Recursive function that handles one step at a time
  const executeStep = (number: number, operation: OperationType): void => {
    // Calculate the new sum based on the operation
    let newSum = sum;
    if (operation === 'add') {
      newSum = sum + number;  // Add the number to current sum
    } else {
      newSum = sum - number;  // Subtract the number from current sum
    }
    
    // Update the sum state with the new value
    setSum(newSum);
    
    // Increment the step counter
    setStep(prevStep => prevStep + 1);
    
    // Create a description of what just happened
    const operationText = operation === 'add' ? 'Added' : 'Subtracted';
    const stepDescription = `Step ${step + 1}: ${operationText} ${number}, Sum = ${newSum}`;
    
    // Add this step to history
    setHistory(prevHistory => [...prevHistory, stepDescription]);
    
    console.log(stepDescription); // Also log to console
    
    // Determine what to do next using conditional logic (no loops)
    
    // If we just added a number from 1 to 9, add the next number
    if (operation === 'add' && number >= 1 && number <= 9) {
      // Use setTimeout to create a delay between steps so we can see them
      setTimeout(() => {
        executeStep(number + 1, 'add'); // Recursively call next addition
      }, 500); // 500ms delay between steps
    }
    
    // If we just added 10, start subtracting from 10
    else if (operation === 'add' && number === 10) {
      setTimeout(() => {
        executeStep(10, 'subtract'); // Start subtracting from 10
      }, 500);
    }
    
    // If we just subtracted a number from 10 to 2, subtract the next lower number
    else if (operation === 'subtract' && number >= 2 && number <= 10) {
      setTimeout(() => {
        executeStep(number - 1, 'subtract'); // Recursively call next subtraction
      }, 500);
    }
    
    // If we just subtracted 1, we're done with all operations
    else if (operation === 'subtract' && number === 1) {
      console.log("All operations completed!");
      setHistory(prevHistory => [...prevHistory, "All operations completed!"]);
    }
  };

  return (
    <div>
      <h1>Number Operations Without Loops</h1>
      
      <p>This demonstrates adding 1 to 10, then subtracting 10 to 1</p>
      <p>Without using any loops - using recursion instead</p>
      
      {/* Button to manually trigger the calculations */}
      <button onClick={startCalculations}>
        Start Calculations Manually
      </button>
      
      {/* Display the current sum */}
      <h2>Current Sum: {sum}</h2>
      
      {/* Display the current step number */}
      <p>Current Step: {step}</p>
      
      {/* Display the calculation history */}
      <div>
        <h3>Calculation History:</h3>
        <div>
          {/* If history is empty, show a message */}
          {history.length === 0 ? (
            <p>No calculations yet. The calculation will start automatically or click the button above.</p>
          ) : (
            // If history has items, display them in a list
            <div>
              {history.map((item: string, index: number) => (
                // Each history item as a separate line
                <div key={index}>
                  {item}
                </div>
              ))}
            </div>
          )}
        </div>
      </div>
      
      {/* Explanation section */}
      <div>
        <h3>How This Works:</h3>
        <ul>
          <li>Uses recursion instead of loops</li>
          <li>Each step calls the next step with setTimeout for delay</li>
          <li>State updates after every single operation</li>
          <li>All steps are recorded in history</li>
        </ul>
      </div>
    </div>
  );
}

export default NumberOperations;